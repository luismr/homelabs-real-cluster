# .gitignore Guide for Homelabs

## What's Ignored

This `.gitignore` file protects your repository from including sensitive or unnecessary files.

### ğŸ”’ Security & Credentials (NEVER COMMIT!)
- SSH private keys (`.pem`, `.key`, `id_rsa`)
- Kubeconfig files (contain cluster access credentials)
- Terraform variables files (`*.tfvars`) - may contain secrets
- Environment files (`.env`) - often contain passwords/tokens
- Any file named with "secret" or "password"

 

### ğŸ—ï¸ Terraform Files
- `.terraform/` - Downloaded providers and modules
- `*.tfstate` - Contains infrastructure state (can have secrets)
- `*.tfplan` - Terraform plan output
- `*.tfvars` - Variable values (often sensitive)

### â˜¸ï¸ Kubernetes Files
- `kubeconfig*` - Cluster access credentials
- `*.token` - Authentication tokens
- `.kube/config` - Default kubectl config

### ğŸ’» OS & Editor Files
- `.DS_Store` (macOS)
- `Thumbs.db` (Windows)
- `.vscode/` - VS Code settings
- `.idea/` - JetBrains IDE files

### ğŸ“ Temporary & Build Files
- `*.log` - Log files
- `*.tmp` - Temporary files
- `*.backup` - Backup files
- `*.swp` - Vim swap files

## What to Commit

### âœ… SAFE to commit:
```
âœ“ README.md, documentation
âœ“ Shell scripts (*.sh)
âœ“ Terraform config files (*.tf)
âœ“ Example/template files (*.example, *.template)
âœ“ .gitignore itself
```

### âŒ NEVER commit:
```
âœ— SSH private keys
âœ— Kubeconfig files
âœ— .tfstate files
âœ— .tfvars files with real values
âœ— Passwords or tokens
âœ— .terraform/ directory
```

## Setup Git Repository

### First Time Setup

```bash
cd ~/homelabs

# Initialize git repository
git init

# Add your files
git add *.sh
git add *.md
git add .gitignore

# Verify what will be committed
git status

# Create initial commit
git commit -m "Initial commit: Homelabs k3s cluster setup"
```

### Check What's Ignored

```bash
# See all ignored files
git status --ignored

# Test if a file would be ignored
git check-ignore -v <filename>

# Example
git check-ignore -v .terraform/
git check-ignore -v kubeconfig
```

## Best Practices

### 1. Never Force-Add Ignored Files

```bash
# âŒ DON'T DO THIS
git add -f id_rsa
git add -f kubeconfig

# These contain sensitive credentials!
```

### 2. Use Example Files for Sensitive Data

```bash
# Create example template
cp secrets.yaml secrets.yaml.example

# Edit example to remove sensitive values
sed 's/password:.*/password: "YOUR_PASSWORD_HERE"/' secrets.yaml.example

# Commit the example
git add secrets.yaml.example
git commit -m "Add secrets template"
```

### 3. Check Before Committing

```bash
# Always review what you're about to commit
git diff --staged

# Look for:
# - Passwords
# - API keys
# - Private IPs (if security concern)
# - Tokens
```

### 4. Create .env.example for Environment Variables

```bash
# .env (IGNORED - contains real values)
GRAFANA_PASSWORD=mysecretpassword123
API_TOKEN=abc123xyz789

# .env.example (COMMITTED - shows structure)
GRAFANA_PASSWORD=your_password_here
API_TOKEN=your_token_here
```

## Common Scenarios

### Scenario 1: Accidentally Committed Secrets

```bash
# Remove file from git but keep locally
git rm --cached kubeconfig
git commit -m "Remove accidentally committed kubeconfig"

# If already pushed to remote
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch kubeconfig" \
  --prune-empty --tag-name-filter cat -- --all

# Force push (WARNING: coordinate with team!)
git push origin --force --all
```

### Scenario 2: Want to Track SSH Public Key

```bash
# Public keys are safe to commit
git add id_rsa.pub
git commit -m "Add SSH public key for team"

# But NEVER commit private keys!
```

### Scenario 3: Terraform State Management

```bash
# Use remote state instead of committing
# In your Terraform config:
terraform {
  backend "s3" {
    bucket = "my-terraform-state"
    key    = "homelabs/terraform.tfstate"
    region = "us-west-2"
  }
}
```

## Customization

### Allow Specific .tfvars File

If you have non-sensitive variables:

```bash
# Edit .gitignore, add at the end:
!variables.tfvars
!dev.tfvars
```

### Track Terraform Lock File

Some teams commit `.terraform.lock.hcl`:

```bash
# Edit .gitignore, comment out or remove:
# .terraform.lock.hcl
```

### Ignore Local Testing Scripts

```bash
# Add to .gitignore:
test-local.sh
my-experiments/
scratch.txt
```

## Verification Checklist

Before pushing to a remote repository:

- [ ] No `.tfstate` files
- [ ] No `.tfvars` files with real values
- [ ] No SSH private keys
- [ ] No kubeconfig files
- [ ] No `.env` files with secrets
- [ ] No `.terraform/` directory
- [ ] No passwords in scripts or config
- [ ] No API tokens or credentials
- [ ] Reviewed `git diff --staged` output

## Remote Repository Setup

### GitHub

```bash
# Create repository on GitHub first, then:
git remote add origin https://github.com/username/homelabs.git
git branch -M main
git push -u origin main
```

### GitLab

```bash
git remote add origin https://gitlab.com/username/homelabs.git
git branch -M main
git push -u origin main
```

### Private Git Server

```bash
git remote add origin git@gitserver.local:repos/homelabs.git
git push -u origin main
```

## What Your Repository Should Look Like

```
homelabs/
â”œâ”€â”€ .gitignore              âœ“ Committed
â”œâ”€â”€ README.md               âœ“ Committed
â”œâ”€â”€ docs/                  âœ“ Committed (folder)
â”‚   â”œâ”€â”€ SETUP-GUIDE.md         âœ“ Committed
â”‚   â”œâ”€â”€ CLUSTER-INFO.md        âœ“ Committed
â”‚   â”œâ”€â”€ LOKI-GUIDE.md          âœ“ Committed
â”‚   â”œâ”€â”€ GIT-QUICK-REFERENCE.md âœ“ Committed
â”‚   â””â”€â”€ .gitignore-README.md   âœ“ Committed
â”œâ”€â”€ scripts/               âœ“ Committed (folder)
â”‚   â”œâ”€â”€ setup-cluster.sh       âœ“ Committed
â”‚   â”œâ”€â”€ install-k3s-master.sh  âœ“ Committed
â”‚   â”œâ”€â”€ install-k3s-worker.sh  âœ“ Committed
â”‚   â”œâ”€â”€ install-observability.sh âœ“ Committed
â”‚   â”œâ”€â”€ verify-cluster.sh      âœ“ Committed
â”‚   â””â”€â”€ ssh-nodes.sh           âœ“ Committed
â”œâ”€â”€ .env.example           âœ“ Committed (template)
â”œâ”€â”€ secrets.yaml.example   âœ“ Committed (template)
â”‚
â”œâ”€â”€ *.log                  âœ— Ignored
â”œâ”€â”€ .kube/config          âœ— Ignored
â”œâ”€â”€ kubeconfig            âœ— Ignored
â”œâ”€â”€ .env                  âœ— Ignored (real secrets)
â”œâ”€â”€ secrets.yaml          âœ— Ignored (real secrets)
â”œâ”€â”€ id_rsa                âœ— Ignored
â””â”€â”€ .DS_Store             âœ— Ignored
```

## Quick Reference

### View Ignored Files
```bash
git status --ignored
```

### View Tracked Files
```bash
git ls-tree -r main --name-only
```

### Check File Against .gitignore
```bash
git check-ignore -v <filename>
```

### Ignore File Already Tracked
```bash
git rm --cached <filename>
git commit -m "Stop tracking <filename>"
```

### Force Add Ignored File (USE CAREFULLY!)
```bash
git add -f <filename>  # Only if you're sure it's safe!
```

## Resources

- [Git Documentation](https://git-scm.com/doc)
- [GitHub .gitignore Templates](https://github.com/github/gitignore)
- [Terraform .gitignore Best Practices](https://www.terraform.io/docs/language/settings/backends/local.html)
- [Secrets Detection Tools](https://github.com/awslabs/git-secrets)

## Security Tools

### git-secrets
Prevents committing secrets:

```bash
# Install
brew install git-secrets  # macOS
apt-get install git-secrets  # Linux

# Setup
cd ~/homelabs
git secrets --install
git secrets --register-aws
```

### gitleaks
Scan repository for secrets:

```bash
# Install
brew install gitleaks  # macOS

# Scan
gitleaks detect --source . --verbose
```

---

**Remember**: Once sensitive data is committed to git, it's in the history forever (unless you rewrite history). Always review before committing!

